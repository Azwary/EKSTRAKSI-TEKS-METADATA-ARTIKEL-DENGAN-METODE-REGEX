{% extends 'layouts/base.html' %}
{% block title %}Users{% endblock %}
{% block content %}

<body>
    <nav class="bg-white shadow-lg mb-4">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center h-12">

                <div class="flex-shrink-0 border-b border-black">
                    <h1 class="text-xl font-bold ">Users</h1>
                </div>

                <div class="flex items-center space-x-4">

                    <div class="relative">
                        <button id="user-menu-button"
                            class="flex items-center space-x-2 bg-white rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <!-- <i class="fas fa-book"></i> -->
                            <span class="text-gray-700 font-medium">{{ session['role'] }}</span>
                            <i class="fas fa-chevron-down text-gray-500 pl-1 pr-3"></i>
                        </button>

                        <div id="user-menu"
                            class="hidden absolute right-0 mt-2 w-24 bg-white shadow-lg rounded-md py-2">
                            <!-- <span class="text-gray-700 font-medium">{{ session['username'] }}</span> -->
                            <!-- <a href="/settings" class="block px-4 py-2 text-gray-700 hover:bg-gray-200">Settings</a> -->
                            <a href="/logout" class="block px-4 py-2 text-gray-700 hover:bg-gray-200"><i
                                    class="fas fa-sign-out-alt pr-3"></i>logout</a></li></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <button class="proses mb-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
        onclick="location.href='/adduser';">Add New User</button>

    <table class="min-w-full border-collapse border border-gray-200 mb-4">
        <thead>
            <tr>
                <th class="border border-gray-300 px-4 py-2">ID</th>
                <th class="border border-gray-300 px-4 py-2">Name</th>
                <th class="border border-gray-300 px-4 py-2">Email</th>
                <th class="border border-gray-300 px-4 py-2">Affiliation</th>
                <th class="border border-gray-300 px-4 py-2">Scopus ID</th>
                <th class="border border-gray-300 px-4 py-2">Sinta ID</th>
                <th class="border border-gray-300 px-4 py-2">Google Scholar ID</th>
                <th class="border border-gray-300 px-4 py-2">ORCID</th>
                <th class="border border-gray-300 px-4 py-2">WhatsApp</th>
                <th class="border border-gray-300 px-4 py-2">Role</th>
                <th class="border border-gray-300 px-4 py-2">Status</th>
                <th class="border border-gray-300 px-4 py-2">Actions</th>

            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <td class="border border-gray-300 px-4 py-2">{{ loop.index }}</td>
            <td class="border border-gray-300 px-4 py-2">{{ user.nama }}</td>
            <td class="border border-gray-300 px-4 py-2">{{ user.email }}</td>
            <td class="border border-gray-300 px-4 py-2">{{ user.nama_afiliasi }}</td>
            <td class="border border-gray-300 px-4 py-2">
                <a href="https://www.scopus.com/authid/detail.uri?authorId={{ user.ID_Scopus }}" target="_blank"
                    class="text-blue-600 hover:underline">
                    {{ user.ID_Scopus }}
                </a>
            </td>
            <td class="border border-gray-300 px-4 py-2">
                <a href="https://sinta.kemdikbud.go.id/authors/profile/{{ user.ID_Sinta }}" target="_blank"
                    class="text-blue-600 hover:underline">
                    {{ user.ID_Sinta }}
                </a>
            </td>

            <td class="border border-gray-300 px-4 py-2">
                <a href="https://scholar.google.co.id/citations?user={{ user.ID_GoogleScholar }}" target="_blank"
                    class="text-blue-600 hover:underline">
                    {{ user.ID_GoogleScholar }}
                </a>
            </td>
            <td class="border border-gray-300 px-4 py-2">
                <a href="https://orcid.org/{{ user.ID_Scopus }}" target="_blank" class="text-blue-600 hover:underline">
                    {{ user.ORCID }}
                </a>
            </td>
            <td class="border border-gray-300 px-4 py-2 text-center">
                {% set no_wa = user.NoWa.replace('+', '') %}
                {{ no_wa[:4] }} {{ no_wa[4:8] }} {{ no_wa[8:] }}
                <span>
                    <a href="https://wa.me/{{ no_wa }}" target="_blank" rel="noopener noreferrer"
                        class="text-blue-500 hover:text-blue-700">
                        <img src="https://img.icons8.com/color/48/000000/whatsapp--v1.png" alt="WhatsApp"
                            class="inline-block w-6 h-6 ml-2">
                    </a>
                </span>
            </td>
            <td class="border border-gray-300 px-4 py-2">{{ user.role }}</td>
            <td class="border border-gray-300 px-4 py-2 text-center">
                {% if user.status == 'Non-Active' %}
                <form method="POST" action="{{ url_for('routes.update_status', user_id=user.id, status='Active') }}"
                    onsubmit="return confirm('Are you sure you want to change the status to active?');">
                    <button type="submit" class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-3 rounded">
                        {{ user.status }}
                    </button>
                </form>
                {% elif user.status == 'Active' %}
                <form method="POST" action="{{ url_for('routes.update_status', user_id=user.id, status='Non-Active') }}"
                    onsubmit="return confirm('Are you sure you want to change the status to inactive?');">
                    <button type="submit"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-3 rounded">
                        {{ user.status }}
                    </button>
                </form>
                {% else %}
                <span class="text-gray-500">
                    {{ user.status }}
                </span>
                {% endif %}
            </td>
            <td class="border px-4 py-2 text-center">
                <div class="flex gap-2 justify-center">
                    <a href="{{ url_for('routes.edit_user', user_id=user.id) }}"
                        class="edit-user-button bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-3 rounded">Edit</a>
                    <form method="POST" action="{{ url_for('routes.delete_user', user_id=user.id) }}"
                        style="display:inline;"
                        onsubmit="return confirm('Are you sure you want to delete this user?');">
                        <button type="submit"
                            class="delete-user-button bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-3 rounded">
                            Delete
                        </button>
                    </form>
                </div>
            </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="12" class="text-center py-4">No users found.</td>
            </tr>
            {% endfor %}
        </tbody>

    </table>
    <script>
        document.getElementById("user-menu-button").addEventListener("click", function () {
            document.getElementById("user-menu").classList.toggle("hidden");
        });

        window.addEventListener("click", function (e) {
            if (!document.getElementById("user-menu-button").contains(e.target)) {
                document.getElementById("user-menu").classList.add("hidden");
            }
        });
    </script>
</body>
{% endblock %}